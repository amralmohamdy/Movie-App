import{a as F}from"./chunk-SGQGAOMW.js";import{a as L}from"./chunk-FJ6JWJHS.js";import{c as A}from"./chunk-QU2DSLHC.js";import"./chunk-ZR5CBTAD.js";import{Aa as y,Ba as l,C as h,Ca as k,D as f,Da as I,J as d,T as r,Xa as w,Y as D,e as c,ea as v,fa as _,ha as N,ia as C,ja as G,ka as p,la as a,lb as V,ma as s,na as x,ra as M,sa as g,sb as R,ua as m,ub as j,vb as B,y as b}from"./chunk-G3D7CDXJ.js";var O=(i,e)=>e.id;function $(i,e){i&1&&x(0,"app-skeleton",2),i&2&&p("type","btns")}function q(i,e){if(i&1&&(a(0,"div",3),l(1),s()),i&2){let n=m();r(),k(n.errorGenres())}}function z(i,e){if(i&1&&(a(0,"button",14),l(1),s()),i&2){let n=e.$implicit,t=m();y("my-btn",t.selectedGenreId()===n.id)("text-white",t.selectedGenreId()===n.id),p("routerLink","/genres/"+n.id),r(),I(" ",n.name," ")}}function H(i,e){i&1&&x(0,"app-skeleton",2),i&2&&p("type","list")}function J(i,e){if(i&1&&(a(0,"div",7),l(1),s()),i&2){let n=m();r(),k(n.errorMovies())}}function K(i,e){if(i&1&&x(0,"app-item",15),i&2){let n=e.$implicit;p("film",n)}}function Q(i,e){if(i&1&&(a(0,"div",8),C(1,K,1,1,"app-item",15,O),s()),i&2){let n=m();r(),G(n.movies())}}function U(i,e){i&1&&(a(0,"div",9),l(1,"No movies found for this genre."),s())}function W(i,e){if(i&1){let n=M();a(0,"button",16),g("click",function(){h(n);let o=m();return f(o.changePage(o.visiblePages()[0]-1))}),l(1,"\u2026"),s()}}function X(i,e){if(i&1){let n=M();a(0,"button",16),g("click",function(){let o=h(n).$implicit,u=m();return f(u.changePage(o))}),l(1),s()}if(i&2){let n=e.$implicit,t=m();y("my-btn",t.page()===n)("text-white",t.page()===n),r(),I(" ",n," ")}}function Y(i,e){if(i&1){let n=M();a(0,"button",16),g("click",function(){h(n);let o=m();return f(o.changePage(o.visiblePages()[o.visiblePages().length-1]+1))}),l(1," \u2026 "),s()}}var T=class i{route=b(R);moviesResources=b(A);router=b(j);IMAGE_BASE="https://image.tmdb.org/t/p/w500";genres=d([]);movies=d([]);loadingGenres=d(!1);errorGenres=d(null);loadingMovies=d(!1);errorMovies=d(null);selectedGenreId=d(null);page=d(1);totalPages=d(1);selectedGenreName=w(()=>{let e=this.selectedGenreId();return e?this.genres().find(n=>n.id===e)?.name??"Selected":"All"});visiblePages=w(()=>{let e=this.page(),n=this.totalPages(),t=5,o=Math.floor(t/2),u=Math.max(1,e-o),E=Math.min(n,u+t-1);u=Math.max(1,E-t+1);let S=[];for(let P=u;P<=E;P++)S.push(P);return S});ngOnInit(){return c(this,null,function*(){yield this.loadGenres(),this.route.paramMap.subscribe(e=>c(this,null,function*(){let n=e.get("id"),t=n?Number(n):0;t!==this.selectedGenreId()&&(this.selectedGenreId.set(t),this.page.set(1),yield this.loadMovies())}))})}loadGenres(){return c(this,null,function*(){this.loadingGenres.set(!0),this.errorGenres.set(null);try{let e=yield this.moviesResources.genresList.value();this.genres.set(e??[])}catch(e){this.errorGenres.set(e instanceof Error?e.message:String(e)),this.genres.set([])}finally{this.loadingGenres.set(!1)}})}selectGenre(e){return c(this,null,function*(){this.selectedGenreId()!==e&&(this.selectedGenreId.set(e),this.page.set(1),yield this.loadMovies())})}loadMovies(){return c(this,null,function*(){this.loadingMovies.set(!0),this.errorMovies.set(null);try{let e=this.selectedGenreId()??0,n=this.page(),t=this.moviesResources.lang(),o=yield this.moviesResources.fetchMoviesByGenre(e,n,t);this.movies.set(o?.results??[]),this.totalPages.set(o?.total_pages??1)}catch(e){this.errorMovies.set(e instanceof Error?e.message:String(e)),this.movies.set([]),this.totalPages.set(1)}finally{this.loadingMovies.set(!1)}})}changePage(e){return c(this,null,function*(){e=Math.max(1,Math.min(e,this.totalPages())),this.page.set(e),yield this.loadMovies()})}nextPage(){return c(this,null,function*(){yield this.changePage(this.page()+1)})}prevPage(){return c(this,null,function*(){yield this.changePage(this.page()-1)})}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=D({type:i,selectors:[["app-genres"]],decls:23,vars:10,consts:[[1,"container","mx-auto","p-4"],[1,"text-2xl","font-semibold","mb-4"],[3,"type"],[1,"text-error-500","mb-4"],[1,"flex","flex-wrap","gap-2","mb-6"],["routerLink","/genres",1,"btn","btn-ghost","btn-outline","border","px-3","py-2","rounded-full",3,"click"],[1,"btn","btn-ghost","btn-outline","border","px-3","py-2","rounded-full",3,"my-btn","text-white","routerLink"],[1,"text-red-500"],[1,"grid","grid-cols-2","sm:grid-cols-3","md:grid-cols-4","lg:grid-cols-5","gap-4","my-8"],[1,"py-8","text-center","text-muted"],[1,"join","flex","justify-center","mt-8"],[1,"join-item","btn",3,"click","disabled"],[1,"join-item","btn"],[1,"join-item","btn",3,"my-btn","text-white"],[1,"btn","btn-ghost","btn-outline","border","px-3","py-2","rounded-full",3,"routerLink"],[3,"film"],[1,"join-item","btn",3,"click"]],template:function(n,t){n&1&&(a(0,"div",0)(1,"h1",1),l(2,"Genres"),s(),v(3,$,1,1,"app-skeleton",2)(4,q,2,1,"div",3),a(5,"div",4)(6,"button",5),g("click",function(){return t.selectGenre(0)}),l(7," All "),s(),C(8,z,2,6,"button",6,O),s(),v(10,H,1,1,"app-skeleton",2)(11,J,2,1,"div",7)(12,Q,3,0,"div",8)(13,U,2,0,"div",9),a(14,"div",10)(15,"button",11),g("click",function(){return t.prevPage()}),l(16,"\xAB"),s(),v(17,W,2,0,"button",12),C(18,X,2,5,"button",13,N),v(20,Y,2,0,"button",12),a(21,"button",11),g("click",function(){return t.nextPage()}),l(22," \xBB "),s()()()),n&2&&(r(3),_(t.loadingGenres()?3:t.errorGenres()?4:-1),r(3),y("my-btn",t.selectedGenreId()===null||t.selectedGenreId()===0)("text-white",t.selectedGenreId()===null||t.selectedGenreId()===0),r(2),G(t.genres()),r(2),_(t.loadingMovies()?10:t.errorMovies()?11:!t.loadingMovies()&&!t.errorMovies()?12:!t.loadingMovies()&&t.movies().length===0?13:-1),r(5),p("disabled",t.page()===1),r(2),_(t.visiblePages()[0]>1?17:-1),r(),G(t.visiblePages()),r(2),_(t.visiblePages()[t.visiblePages().length-1]<t.totalPages()?20:-1),r(),p("disabled",t.page()===t.totalPages()))},dependencies:[V,L,F,B],styles:[".my-btn[_ngcontent-%COMP%]{background:var(--hover-color);border:var(--hover-color);color:var(--white-color)}.my-btn[_ngcontent-%COMP%]:hover{background:var(--primary-color);border:var(--primary-color)}"],changeDetection:0})};export{T as default};
